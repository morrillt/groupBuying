require 'lib/simple_geo_script/simple_geo'
#10-935
class SimpleGeoData < ActiveRecord::Base
  def test_data
    sg =  SimpleGeo::SimpleGeoCollector.new
    deals = Deal.all
    puts "deals: #{deals.size}"
    init = Time.now
    fails = 0
    error = 0
    winning = 0
    number = Array.new
    for deal in deals
      begin        
        h = sg.parsing deal
        r = sg.search h
        puts "eql address #{r}"
        if r.nil? 
          number.push r
        end
      rescue
        error +=1
      end
    end
    puts "neaas #{number.length} errors :#{error}"
    numbers = numbers.flatten
    zero = 0
    one = 0
    many = 0
    for i in numbers
      if i==0
        zero += 1
      elsif i == 1
        one += 1        
      else
        many += 1
      end      
    end
    puts "zero #{zero/numbers.lenght}, one: #{one/numbers.lenght}, many: #{many/numbers.length}"
  end

  def test_ind_data deal
    sg =  SimpleGeo::SimpleGeoCollector.new
    init = Time.now
    fails = 0
    error = 0
    winning = 0
    begin
      h = sg.parsing deal
      r = sg.search h
      if r.nil? 
        puts "#{deal.id} fails"
        fails += 1
      else
        puts "#{deal.id} wins"
        winning += 1
      end
    rescue
      puts "#{deal.id} died"
      error +=1
    end
    puts "time: #{((Time.now)-init)/60} mins success:#{winning} fails:#{fails} error:#{error}"
  end
end
